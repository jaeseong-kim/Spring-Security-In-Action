# 17장: 전역 메서드 보안: 사전 및 사후 필터링

## 필터링
    
    필터링은 매개변수나 리턴 값이 컬렉션 또는 배열이어야 하고 매개변수나 리턴값을 필터링 역할을 한다.
    필터링을 사용하기 위해서는 설정파일에서 @EnableGlobalMethodSecurity(prePostEnabled = true)로
    설정하고 원하는 메소드에 preFilter, postFilter 어노테이션을 붙여 사용할 수 있다.

## 필터링 작동방식

    필터링을 사용하면 aspect가 생성된다.
    preFilter를 사용하면 대상 메소드 호출 하기 전에 메소드의 인자가 preFilter에 부합하는지 확인 후,
    위배되는 값이 있다면 그것을 제외하고 부합하는 값만 인자값으로 전달한다.
    postFilter를 사용하면 메소드 호출 후 반환되는 값에 대해 부합되지 않는 값은 필터링 한 후, 부합하는
    값만 호출자에 전달한다.

    필터링은 전달값을 삭제하고 전달하기 때문에 변경할 수 있는 객체여야 한다.
    예료 변경할 수 없는 객체인 List.of()를 사용하면 aspect에서는 값을 변경할 수 없기 때문에 예외가 발생한다.
    
## 권한 부여와 비교
    
    필터링은 spel식에 부합하지 않는 값은 제외하고 부합하는 값을 보낸다.
    하지만 권한 부여는 spel식을 만족하지 않으면 예외가 발생한다.
    그리고 권한 부여는 전달값이 컬렉션이나 배열이 아니어도 가능하다. 

## 서비스 계층에서의 필터링

    서비스 계층에서 필터링은 기본 필터링의 동작방식과 같다.

## 레포지토리 계층에서의 필터링
    
    레포지토리에서 필터링은 postFilter를 사용하지 않는 편이 좋다. 왜냐하면 모든 레코드를 가져오는 경우,
    메모리 초과가 발생할 수 있기 때문이다. 호출할 때 원하는 레코드를 호출할 수 있도록 Query 어노테이션을
    이용하는 편이 좋다.